# --- Server 1: The Main Web Application ---
server {
    listen 8080;
    server_name localhost www.example.com;
    
    # Global settings for this server
    root /var/www/html;
    index index.html index.htm;
    client_max_body_size 10m;  # Test 'm' parsing
    error_page 404 /404.html;
    error_page 500 502 503 504 /50x.html;

    # 1. Standard Route
    location / {
        autoindex on;  # Should list files if index is missing
        limit_except GET {
            deny all;
        }
    }

    # 2. Uploads (Testing separate store & body size override)
    location /upload {
        client_max_body_size 100m; # Override parent limit
        upload_store /var/www/uploads;
        limit_except POST {
            deny all;
        }
    }

    # 3. CGI Execution (Python/PHP)
    location /cgi-bin {
        root /usr/lib/cgi-bin;
        cgi_pass /usr/bin/python3;
        index main.py;
    }

    # 4. Redirect Test
    location /old-page {
        return 301 /new-page;
    }

    # 5. Nested Location (Inheritance Test)
    location /images {
        root /var/www/media; # Overrides server root
        autoindex off;

        location /images/secret {
            autoindex on; # Overrides parent autoindex
            limit_except GET {
                deny all;
            }
        }
    }
}
