# SERVER 1: The "Heavy Duty" Server
server {
    listen 8080;
    server_name example.com www.example.com;
    
    # Global Defaults (Children should inherit these)
    root /var/www/html;
    index index.html index.htm;
    client_max_body_size 1000000; # 1MB Default
    error_page 404 /404.html;
    error_page 500 /500.html;

    # 1. Standard Location (Inherits everything)
    location / {
        autoindex off;
    }

    # 2. Nested Locations & Inheritance Test
    location /api {
        # Overrides global settings
        client_max_body_size 50000; # Stricter limit (50KB)
        autoindex on;

        # Child of /api (Should be flattened to "/api/v1")
        # Should inherit root=/var/www/html AND size=50000
        location /v1 {
            index api_index.json;
            
            # Grandchild (Flattened to "/api/v1/admin")
            location /admin {
                # Test Limit Except (Block)
                limit_except GET {
                    deny all;
                }
            }
        }
    }

    # 3. Upload Feature Test
    location /upload {
        # Allow huge files here
        client_max_body_size 100000000; # 100MB
        upload_store /var/www/uploads;
        limit_except POST DELETE {
            deny all;
        }
    }

    # 4. Redirection Test
    location /old-page {
        return 301 /new-page;
    }

    # 5. CGI Test
    location /cgi-bin {
        root /usr/lib/cgi-bin;
        # Only ONE CGI handler allowed per location with current logic
        cgi_pass .py /usr/bin/python3;
    }
}

# SERVER 2: The "Minimal" Server (To test separation)
server {
    listen 9090;
    server_name localized.com;
    root /var/www/local;

    location / {
        index default.html;
    }
}
